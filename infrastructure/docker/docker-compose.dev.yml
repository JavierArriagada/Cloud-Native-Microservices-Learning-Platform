# =============================================================================
# Cloud-Native Microservices Learning Platform - Docker Compose Development
# =============================================================================
# Este archivo contiene overrides para desarrollo local
# Incluye hot reload, debugging, y volúmenes para código fuente
# Uso: docker compose -f docker-compose.yml -f docker-compose.dev.yml up
# =============================================================================

services:
  # ===========================================================================
  # API - Development overrides
  # ===========================================================================
  api:
    build:
      context: ../../services/api
      dockerfile: Dockerfile.dev
      target: development
    environment:
      API_DEBUG: "true"
      API_RELOAD: "true"
      ENVIRONMENT: development
      PYTHONUNBUFFERED: "1"
      PYTHONDONTWRITEBYTECODE: "1"
    volumes:
      # Mount source code for hot reload
      - ../../services/api/app:/app/app:cached
      - ../../services/api/tests:/app/tests:cached
    ports:
      # Expose port directly for debugging
      - "8000:8000"
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

  # ===========================================================================
  # Dash - Development overrides
  # ===========================================================================
  dash:
    build:
      context: ../../services/dash-app
      dockerfile: Dockerfile.dev
      target: development
    environment:
      DASH_DEBUG: "true"
    volumes:
      # Mount source code for hot reload
      - ../../services/dash-app/app:/app/app:cached
      - ../../services/dash-app/assets:/app/assets:cached
    ports:
      # Expose port directly for debugging
      - "8050:8050"

  # ===========================================================================
  # React - Development overrides
  # ===========================================================================
  react:
    build:
      context: ../../services/react-app
      dockerfile: Dockerfile.dev
      target: development
    environment:
      NODE_ENV: development
    volumes:
      # Mount source code for hot reload
      - ../../services/react-app/src:/app/src:cached
      - ../../services/react-app/public:/app/public:cached
      # Exclude node_modules
      - /app/node_modules
    ports:
      # Expose Vite dev server directly
      - "3000:3000"
    command: npm run dev -- --host 0.0.0.0

  # ===========================================================================
  # PostgreSQL - Development overrides
  # ===========================================================================
  postgres:
    ports:
      # Expose PostgreSQL for direct access
      - "5432:5432"
    environment:
      # Enable verbose logging in development
      POSTGRES_INITDB_ARGS: "--encoding=UTF-8 --locale=C"
    command:
      - "postgres"
      - "-c"
      - "log_statement=all"
      - "-c"
      - "log_destination=stderr"
      - "-c"
      - "logging_collector=off"

# =============================================================================
# FIN DE DOCKER-COMPOSE.DEV.YML
# =============================================================================
